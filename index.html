<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#faf8ef">
    <title>2048 - 经典数字游戏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" href="icon-192.png">
</head>
<body>
    <!-- 主菜单 -->
    <div id="main-menu" class="page-container">
        <header class="game-header">
            <h1 class="game-title">2048</h1>
            <p class="game-subtitle">合并数字，挑战极限！</p>
        </header>
        
        <div class="stats-summary">
            <div class="stat-card">
                <span class="stat-label">最高分</span>
                <span class="stat-value" id="best-score-display">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">游戏次数</span>
                <span class="stat-value" id="total-games-display">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">胜利次数</span>
                <span class="stat-value" id="total-wins-display">0</span>
            </div>
        </div>
        
        <div class="menu-buttons">
            <button id="new-game-btn" class="menu-btn primary">
                🎮 开始新游戏
            </button>
            <button id="continue-btn" class="menu-btn secondary">
                🔄 继续游戏
            </button>
            <div id="saved-game-info" style="display: none;"></div>
            
            <button id="stats-btn" class="menu-btn">
                📊 游戏统计
            </button>
            <button id="settings-btn" class="menu-btn">
                ⚙️ 游戏设置
            </button>
            <button id="about-btn" class="menu-btn">
                ℹ️ 游戏说明
            </button>
            
            <button id="install-pwa-btn" class="menu-btn install-btn">
                📱 添加到主屏幕
            </button>
        </div>
        
        <footer class="game-footer">
            <p>支持离线游玩 • 自动存档 • 支持触摸控制</p>
        </footer>
    </div>
    
    <!-- 游戏界面 -->
    <div id="game-container" class="page-container" style="display: none;">
        <!-- game.html的内容将通过main.js动态加载或直接嵌入 -->
    </div>
    
    <!-- 统计页面 -->
    <div id="stats-page" class="page-container" style="display: none;">
        <header class="page-header">
            <button class="back-btn">← 返回</button>
            <h2>📊 游戏统计</h2>
        </header>
        
        <div class="stats-details">
            <div class="stat-item">
                <span class="stat-name">最高分数</span>
                <span class="stat-number" id="stats-best-score">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-name">总游戏次数</span>
                <span class="stat-number" id="stats-total-games">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-name">胜利次数</span>
                <span class="stat-number" id="stats-total-wins">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-name">胜率</span>
                <span class="stat-number" id="stats-win-rate">0%</span>
            </div>
            <div class="stat-item">
                <span class="stat-name">平均分数</span>
                <span class="stat-number" id="stats-average-score">0</span>
            </div>
        </div>
        
        <div class="chart-container">
            <h3>胜负统计</h3>
            <canvas id="stats-chart" width="300" height="200"></canvas>
        </div>
        
        <button id="reset-stats-btn" class="danger-btn">🗑️ 重置统计数据</button>
    </div>
    
    <!-- 关于页面 -->
    <div id="about-page" class="page-container" style="display: none;">
        <header class="page-header">
            <button class="back-btn">← 返回</button>
            <h2>ℹ️ 游戏说明</h2>
        </header>
        
        <div id="game-instructions" class="instructions-container">
            <!-- 动态加载游戏说明 -->
        </div>
        
        <div class="about-info">
            <h3>📱 关于此版本</h3>
            <ul>
                <li><strong>版本：</strong>1.2.0 (PWA优化版)</li>
                <li><strong>平台：</strong>支持iOS/Android/PC</li>
                <li><strong>特性：</strong>离线游玩、自动存档、触摸控制</li>
                <li><strong>开发：</strong>基于经典2048游戏</li>
            </ul>
        </div>
    </div>
    
    <!-- 设置页面 -->
    <div id="settings-page" class="page-container" style="display: none;">
        <header class="page-header">
            <button class="back-btn">← 返回</button>
            <h2>⚙️ 游戏设置</h2>
        </header>
        
        <div class="settings-container">
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="animations-toggle">
                    <span>启用动画效果</span>
                </label>
            </div>
            
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="sound-toggle">
                    <span>启用音效（开发中）</span>
                </label>
            </div>
            
            <div class="setting-item" id="vibration-setting" style="display: none;">
                <label>
                    <input type="checkbox" id="vibration-toggle">
                    <span>启用震动反馈</span>
                </label>
            </div>
            
            <div class="setting-item">
                <label>
                    <input type="checkbox" id="dark-mode-toggle">
                    <span>深色模式</span>
                </label>
            </div>
            
            <div class="setting-item">
                <label for="grid-size-select">网格大小：</label>
                <select id="grid-size-select">
                    <option value="4">4×4 (经典)</option>
                    <option value="5">5×5 (挑战)</option>
                    <option value="6">6×6 (困难)</option>
                </select>
            </div>
        </div>
        
        <div class="settings-buttons">
            <button id="save-settings-btn" class="primary">💾 保存设置</button>
            <button id="reset-data-btn" class="danger">🗑️ 重置游戏数据</button>
        </div>
    </div>
    
    <script src="game.js"></script>
    <script src="main.js"></script>
    <script src="pwa-register.js"></script>
    <script>
        // 立即加载游戏控制器
        document.addEventListener('DOMContentLoaded', function() {
            // 动态加载game.html的内容到游戏容器
            fetch('game.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('game-container').innerHTML = html;
                    // 加载完成后初始化游戏
                    if (typeof initGame === 'function') {
                        initGame();
                    }
                })
                .catch(error => {
                    console.error('加载游戏页面失败:', error);
                    document.getElementById('game-container').innerHTML = 
                        '<div class="error-message">游戏加载失败，请刷新页面</div>';
                });
        });
    </script>
</body>
</html>
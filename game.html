<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#faf8ef">
    <title>2048 - æ¸¸æˆä¸­</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="game-style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
/* ==================== æš–è‰²ç³»ï¼ˆå°æ•°å­—ï¼‰ ==================== */
/* 2: ç±³é»„è‰² ğŸŸ¡ */
.tile-2 { 
    background: linear-gradient(135deg, #FFF8DC 0%, #FAEBD7 100%) !important; 
    color: #8B7355 !important;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8) !important;
    box-shadow: 0 4px 8px rgba(255, 248, 220, 0.5) !important;
}

/* 4: æ¡ƒè‰² ğŸ‘ */
.tile-4 { 
    background: linear-gradient(135deg, #FFDAB9 0%, #FFC0CB 100%) !important; 
    color: #8B5A2B !important;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8) !important;
    box-shadow: 0 4px 8px rgba(255, 218, 185, 0.5) !important;
}

/* 8: æ©™é»„è‰² ğŸŸ  */
.tile-8 { 
    background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 4px 10px rgba(255, 165, 0, 0.6) !important;
    font-size: min(5.8vw, 30px) !important;
}

/* 16: æ©™çº¢è‰² ğŸ”´ */
.tile-16 { 
    background: linear-gradient(135deg, #FF4500 0%, #FF6347 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 4px 10px rgba(255, 69, 0, 0.6) !important;
    font-size: min(5.8vw, 30px) !important;
}

/* 32: çº¢è‰² ğŸ”¥ */
.tile-32 { 
    background: linear-gradient(135deg, #DC143C 0%, #B22222 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6) !important;
    box-shadow: 0 4px 12px rgba(220, 20, 60, 0.7) !important;
    font-size: min(5.8vw, 30px) !important;
}

/* 64: æ·±çº¢è‰² ğŸ©¸ */
.tile-64 { 
    background: linear-gradient(135deg, #8B0000 0%, #660000 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(255, 255, 255, 0.5) !important;
    box-shadow: 0 4px 12px rgba(139, 0, 0, 0.7) !important;
    font-size: min(5.8vw, 30px) !important;
}

/* ==================== é‡‘è‰²ç³»ï¼ˆä¸­ç­‰æ•°å­—ï¼‰ ==================== */
/* 128: é‡‘è‰² ğŸ¥‡ */
.tile-128 { 
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 5px 15px rgba(255, 215, 0, 0.6) !important;
    font-size: min(5vw, 26px) !important;
}

/* 256: äº®æ©™è‰² ğŸŸ§ */
.tile-256 { 
    background: linear-gradient(135deg, #FF8C00 0%, #FF4500 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 5px 15px rgba(255, 140, 0, 0.6) !important;
    font-size: min(5vw, 26px) !important;
}

/* 512: çŠç‘šè‰² ğŸª¸ */
.tile-512 { 
    background: linear-gradient(135deg, #FF7F50 0%, #FF6347 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 5px 15px rgba(255, 127, 80, 0.6) !important;
    font-size: min(5vw, 26px) !important;
}

/* ==================== å†·è‰²ç³»ï¼ˆå¤§æ•°å­—ï¼‰ ==================== */
/* 1024: ç´«è‰² ğŸŸ£ */
.tile-1024 { 
    background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 6px 18px rgba(147, 112, 219, 0.7) !important;
    font-size: min(4.2vw, 22px) !important;
}

/* 2048: é›è“è‰² ğŸ”µ */
.tile-2048 { 
    background: linear-gradient(135deg, #4B0082 0%, #483D8B 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(255, 255, 255, 0.5) !important;
    box-shadow: 0 6px 18px rgba(75, 0, 130, 0.7) !important;
    font-size: min(4.2vw, 22px) !important;
    animation: glow 2s ease-in-out infinite alternate !important;
}

/* 4096: é’è‰² ğŸ©µ */
.tile-4096 { 
    background: linear-gradient(135deg, #00CED1 0%, #20B2AA 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 6px 20px rgba(0, 206, 209, 0.7) !important;
    font-size: min(3.8vw, 20px) !important;
    animation: pulse 2s ease-in-out infinite !important;
}

/* 8192: é’ç»¿è‰² ğŸ’ */
.tile-8192 { 
    background: linear-gradient(135deg, #40E0D0 0%, #48D1CC 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 6px 20px rgba(64, 224, 208, 0.7) !important;
    font-size: min(3.8vw, 20px) !important;
    animation: pulse 1.5s ease-in-out infinite !important;
}

/* ==================== ç»¿è‰²ç³»ï¼ˆè¶…å¤§æ•°å­—ï¼‰ ==================== */
/* 16384: äº®ç»¿è‰² ğŸ’š */
.tile-16384 { 
    background: linear-gradient(135deg, #32CD32 0%, #228B22 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
    box-shadow: 0 7px 22px rgba(50, 205, 50, 0.8) !important;
    font-size: min(3.5vw, 18px) !important;
    animation: glow 1.2s ease-in-out infinite alternate !important;
}

/* 32768: æ·±ç»¿è‰² ğŸŒ² */
.tile-32768 { 
    background: linear-gradient(135deg, #006400 0%, #2E8B57 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 3px rgba(255, 255, 255, 0.5) !important;
    box-shadow: 0 7px 22px rgba(0, 100, 0, 0.8) !important;
    font-size: min(3.5vw, 18px) !important;
    animation: glow 1s ease-in-out infinite alternate !important;
}

/* ==================== æé™æ•°å­—ä¼˜åŒ–ç‰ˆ ==================== */
/* 65536: ç²‰è‰² ğŸ’– */
.tile-65536 { 
    background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6) !important;
    box-shadow: 0 6px 20px rgba(255, 105, 180, 0.8) !important;
    font-size: min(3.5vw, 18px) !important;  /* å¢å¤§å­—ä½“ */
    font-weight: 900 !important;
    letter-spacing: -0.5px !important;
    animation: pulse 0.8s ease-in-out infinite !important;
    line-height: 1 !important;
    padding: 5px !important;
}

/* 131072: æ·±ç´«è‰² ğŸŸª - ç‰¹æ®Šå¤„ç† */
.tile-131072 { 
    background: linear-gradient(135deg, #9400D3 0%, #4B0082 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7) !important;
    box-shadow: 0 6px 20px rgba(148, 0, 211, 0.8) !important;
    font-size: min(3.2vw, 16px) !important;  /* å¢å¤§å­—ä½“ */
    font-weight: 900 !important;
    letter-spacing: -0.8px !important;
    animation: subtle-glow 0.7s ease-in-out infinite alternate !important;
    line-height: 0.9 !important;
    padding: 4px !important;
}

/* 262144: æ·±è“è‰² ğŸŒŒ */
.tile-262144 { 
    background: linear-gradient(135deg, #000080 0%, #191970 100%) !important; 
    color: white !important;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7) !important;
    box-shadow: 0 6px 20px rgba(0, 0, 128, 0.8) !important;
    font-size: min(3vw, 15px) !important;  /* å¢å¤§å­—ä½“ */
    font-weight: 900 !important;
    letter-spacing: -1px !important;
    animation: pulse 0.6s ease-in-out infinite !important;
    line-height: 0.9 !important;
    padding: 4px !important;
}

/* ==================== æ”¯æŒæ›´å¤šè¶…å¤§æ•°å­— ==================== */
.tile-524288 {
    background: linear-gradient(135deg, #800000 0%, #400000 100%) !important;
    color: white !important;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7) !important;
    font-size: min(2.8vw, 14px) !important;  /* å¢å¤§å­—ä½“ */
    font-weight: 900 !important;
    letter-spacing: -1.2px !important;
    box-shadow: 0 5px 18px rgba(128, 0, 0, 0.8) !important;
    line-height: 0.85 !important;
    padding: 3px !important;
}

.tile-1048576 {
    background: linear-gradient(135deg, #000000 0%, #333333 100%) !important;
    color: gold !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8) !important;
    font-size: min(2.6vw, 13px) !important;  /* å¢å¤§å­—ä½“ */
    font-weight: 900 !important;
    letter-spacing: -1.5px !important;
    box-shadow: 0 5px 18px rgba(0, 0, 0, 0.9) !important;
    animation: subtle-pulse 0.4s ease-in-out infinite !important;
    line-height: 0.8 !important;
    padding: 3px !important;
}

/* ==================== æ–°å¢ï¼šè¶…ç‰¹å¤§æ•°å­—æ”¯æŒ ==================== */
.tile-2097152 {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
    color: #f1c40f !important;
    font-size: min(2.4vw, 12px) !important;
    font-weight: 900 !important;
    letter-spacing: -1.8px !important;
    line-height: 0.75 !important;
    padding: 2px !important;
}

.tile-4194304 {
    background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%) !important;
    color: white !important;
    font-size: min(2.2vw, 11px) !important;
    font-weight: 900 !important;
    letter-spacing: -2px !important;
    line-height: 0.7 !important;
    padding: 2px !important;
}

/* ==================== å“åº”å¼ä¼˜åŒ– ==================== */

/* å°å±å¹•è®¾å¤‡ï¼ˆæ‰‹æœºï¼‰ */
@media (max-width: 375px) {
    /* é’ˆå¯¹iPhone SE/å°å±æ‰‹æœºä¼˜åŒ– */
    .tile-65536 { font-size: min(4vw, 16px) !important; }
    .tile-131072 { font-size: min(3.8vw, 15px) !important; }
    .tile-262144 { font-size: min(3.6vw, 14px) !important; }
    .tile-524288 { font-size: min(3.4vw, 13px) !important; }
    .tile-1048576 { font-size: min(3.2vw, 12px) !important; }
    .tile-2097152 { font-size: min(3vw, 11px) !important; }
    .tile-4194304 { font-size: min(2.8vw, 10px) !important; }
}

/* è¶…å°å±å¹•è®¾å¤‡ */
@media (max-width: 320px) {
    /* é’ˆå¯¹iPhone 5/è¶…å°å±ä¼˜åŒ– */
    .tile-65536 { font-size: min(4.5vw, 14px) !important; }
    .tile-131072 { font-size: min(4.2vw, 13px) !important; }
    .tile-262144 { font-size: min(4vw, 12px) !important; }
    .tile-524288 { font-size: min(3.8vw, 11px) !important; }
    .tile-1048576 { font-size: min(3.6vw, 10px) !important; }
    .tile-2097152 { font-size: min(3.4vw, 9px) !important; }
    .tile-4194304 { font-size: min(3.2vw, 8px) !important; }
    
    /* æé™æ•°å­—ä½¿ç”¨ç¼©å†™ */
    .tile-131072 .tile-inner::after {
        content: '131K';
        font-size: 0.9em;
    }
    .tile-131072 .tile-inner {
        font-size: 0 !important;
        visibility: hidden;
    }
}

/* ä¸­ç­‰å±å¹•è®¾å¤‡ï¼ˆå¹³æ¿ç«–å±ï¼‰ */
@media (min-width: 768px) and (max-width: 1024px) {
    .tile-65536 { font-size: min(2.8vw, 22px) !important; }
    .tile-131072 { font-size: min(2.6vw, 20px) !important; }
    .tile-262144 { font-size: min(2.4vw, 18px) !important; }
    .tile-524288 { font-size: min(2.2vw, 16px) !important; }
    .tile-1048576 { font-size: min(2vw, 14px) !important; }
    .tile-2097152 { font-size: min(1.8vw, 12px) !important; }
    .tile-4194304 { font-size: min(1.6vw, 10px) !important; }
}

/* å¤§å±å¹•è®¾å¤‡ï¼ˆæ¡Œé¢ã€å¹³æ¿æ¨ªå±ï¼‰ */
@media (min-width: 1025px) {
    .tile-65536 { font-size: min(2.2vw, 24px) !important; }
    .tile-131072 { font-size: min(2vw, 22px) !important; }
    .tile-262144 { font-size: min(1.8vw, 20px) !important; }
    .tile-524288 { font-size: min(1.6vw, 18px) !important; }
    .tile-1048576 { font-size: min(1.4vw, 16px) !important; }
    .tile-2097152 { font-size: min(1.2vw, 14px) !important; }
    .tile-4194304 { font-size: min(1vw, 12px) !important; }
}

/* æŠ˜å å±ç­‰ç‰¹æ®Šæ¯”ä¾‹ */
@media (max-aspect-ratio: 3/4) {
    /* é’ˆå¯¹æŠ˜å å±æˆ–ç‰¹æ®Šé•¿å®½æ¯” */
    .tile-65536 { font-size: min(3vw, 14px) !important; }
    .tile-131072 { font-size: min(2.8vw, 13px) !important; }
    .tile-262144 { font-size: min(2.6vw, 12px) !important; }
    .tile-524288 { font-size: min(2.4vw, 11px) !important; }
    .tile-1048576 { font-size: min(2.2vw, 10px) !important; }
    
    /* ä½¿ç”¨æ›´ç´§å‡‘çš„å¸ƒå±€ */
    .tile-large {
        padding: 1px !important;
        margin: 0 !important;
    }
}

/* é«˜DPIå±å¹•ä¼˜åŒ– */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .tile-65536,
    .tile-131072,
    .tile-262144,
    .tile-524288,
    .tile-1048576 {
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.7) !important;
        -webkit-font-smoothing: antialiased !important;
        -moz-osx-font-smoothing: grayscale !important;
    }
}

/* ==================== æ–°å¢åŠ¨ç”»æ•ˆæœ ==================== */
@keyframes subtle-glow {
    0% {
        box-shadow: 0 0 15px rgba(148, 0, 211, 0.6);
        opacity: 0.95;
    }
    100% {
        box-shadow: 0 0 25px rgba(148, 0, 211, 0.8);
        opacity: 1;
    }
}

@keyframes subtle-pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.02);
    }
}

/* ==================== æ•°å­—ç¼©å†™æ˜¾ç¤ºï¼ˆå¯é€‰åŠŸèƒ½ï¼‰ ==================== */
/* åœ¨å¤§æ•°å­—ä¸Šæ˜¾ç¤ºç¼©å†™ */
.tile-abbreviation {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.7em;
    opacity: 0.9;
    display: none;
}

/* å½“æ•°å­—è¿‡å¤§æ—¶æ˜¾ç¤ºç¼©å†™ */
.tile-131072.show-abbreviation .tile-inner,
.tile-262144.show-abbreviation .tile-inner,
.tile-524288.show-abbreviation .tile-inner,
.tile-1048576.show-abbreviation .tile-inner {
    display: none;
}

.tile-131072.show-abbreviation::after {
    content: '131K';
}
.tile-262144.show-abbreviation::after {
    content: '262K';
}
.tile-524288.show-abbreviation::after {
    content: '524K';
}
.tile-1048576.show-abbreviation::after {
    content: '1M';
}
.tile-2097152.show-abbreviation::after {
    content: '2M';
}
.tile-4194304.show-abbreviation::after {
    content: '4M';
}

/* ==================== è¾…åŠ©ç±» ==================== */
.tile-large {
    font-weight: 900 !important;
    letter-spacing: -1px !important;
    /* å¼ºåˆ¶æ¢è¡Œå¤„ç†é•¿æ•°å­— */
    word-wrap: break-word !important;
    word-break: break-all !important;
    overflow-wrap: break-word !important;
}

/* è¶…å¤§æ•°å­—å®¹å™¨ä¼˜åŒ– */
.cell .tile-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* ç¡®ä¿å•å…ƒæ ¼èƒ½å®¹çº³ç‰¹å¤§æ•°å­— */
.cell {
    position: relative;
    overflow: hidden !important;
}
</style>
</head>
<body class="game-page">
    <!-- æ¸¸æˆä¸»å®¹å™¨ -->
    <div id="game-container" class="game-container">
        <!-- æ¸¸æˆå¤´éƒ¨ -->
        <header class="game-header-bar">
            <div class="header-left">
                <button id="back-to-menu" class="back-button" aria-label="è¿”å›ä¸»èœå•">
                    <svg class="back-icon" viewBox="0 0 24 24">
                        <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
                    </svg>
                    <span class="back-text">èœå•</span>
                </button>
            </div>
            
            <div class="header-center">
                <h1 class="game-title-small">2048</h1>
            </div>
            
            <div class="header-right">
                <button id="fullscreen-btn" class="icon-button" aria-label="å…¨å±">
                    <svg viewBox="0 0 24 24">
                        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- åˆ†æ•°å’Œæ’¤é”€ä¿¡æ¯ -->
        <div class="game-info-panel">
            <div class="score-panel">
                <div class="score-box current-score">
                    <div class="score-label">åˆ†æ•°</div>
                    <div class="score-value" id="score">0</div>
                </div>
                
                <div class="score-box best-score">
                    <div class="score-label">æœ€é«˜åˆ†</div>
                    <div class="score-value" id="best">0</div>
                </div>
                
                <div class="score-box undo-box">
                    <div class="score-label">æ’¤é”€</div>
                    <div class="score-value" id="undo-count">3</div>
                    <div class="score-subtext">å‰©ä½™æ¬¡æ•°</div>
                </div>
            </div>
            
            <div class="undo-chances-info">
                <div class="undo-progress">
                    <div class="undo-label">æ’¤é”€æœºä¼š:</div>
                    <div class="undo-dots">
                        <span class="undo-dot active" data-index="1"></span>
                        <span class="undo-dot active" data-index="2"></span>
                        <span class="undo-dot active" data-index="3"></span>
                    </div>
                </div>
                <div id="top-score" class="top-score-display">å½“å‰åˆ†æ•°: <span>0</span></div>
            </div>
        </div>

        <!-- æ¸¸æˆæ¶ˆæ¯åŒºåŸŸ -->
        <div id="message" class="game-message"></div>

        <!-- æ¸¸æˆç½‘æ ¼å®¹å™¨ -->
        <main class="game-main">
            <div class="grid-container">
                <div id="grid" class="game-grid">
                    <!-- è¿™é‡Œå°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ16å®«æ ¼ -->
                </div>
                
                <!-- è§¦æ‘¸æç¤ºï¼ˆä»…ç§»åŠ¨è®¾å¤‡æ˜¾ç¤ºï¼‰ -->
                <div class="touch-hints">
                    <div class="touch-hint-row">
                        <div class="touch-hint">
                            <svg class="touch-arrow" viewBox="0 0 24 24">
                                <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                            </svg>
                            <span class="hint-text">ä¸Šæ»‘</span>
                        </div>
                    </div>
                    <div class="touch-hint-row">
                        <div class="touch-hint">
                            <svg class="touch-arrow" viewBox="0 0 24 24">
                                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                            </svg>
                            <span class="hint-text">ä¸‹æ»‘</span>
                        </div>
                        <div class="grid-center-hint">
                            <div class="hint-circle">æ»‘åŠ¨<br>æ§åˆ¶</div>
                        </div>
                        <div class="touch-hint">
                            <svg class="touch-arrow" viewBox="0 0 24 24">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                            </svg>
                            <span class="hint-text">å·¦æ»‘</span>
                        </div>
                        <div class="touch-hint">
                            <svg class="touch-arrow" viewBox="0 0 24 24">
                                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                            </svg>
                            <span class="hint-text">å³æ»‘</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® -->
        <div class="game-controls">
            <button id="undo" class="control-button undo-button">
                <svg class="button-icon" viewBox="0 0 24 24">
                    <path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>
                </svg>
                <span class="button-text">æ’¤é”€</span>
                <span class="button-badge" id="undo-chances">3</span>
            </button>
            
            <button id="restart" class="control-button restart-button">
                <svg class="button-icon" viewBox="0 0 24 24">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
                <span class="button-text">é‡æ–°å¼€å§‹</span>
            </button>
            
            <button id="hint" class="control-button hint-button" aria-label="æç¤º">
                <svg class="button-icon" viewBox="0 0 24 24">
                    <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
                </svg>
                <span class="button-text">æç¤º</span>
            </button>
        </div>

        <!-- æ¸¸æˆçŠ¶æ€å’Œæç¤º -->
        <div class="game-status">
            <div class="status-indicators">
                <div class="status-item" id="undo-warning-container">
                    <span class="status-icon">âš ï¸</span>
                    <span class="status-text">æ’¤é”€å‰©ä½™: <span id="undo-warning">3</span>æ¬¡</span>
                </div>
                <div class="status-item" id="game-mode-display">
                    <span class="status-icon">ğŸ®</span>
                    <span class="status-text">æ¸¸æˆæ¨¡å¼: ç»å…¸</span>
                </div>
            </div>
            
            <div class="game-tips">
                <div class="tip-card">
                    <h3 class="tip-title">ğŸ’¡ æ¸¸æˆæŠ€å·§</h3>
                    <ul class="tip-list">
                        <li>å°†æœ€å¤§çš„æ–¹å—å›ºå®šåœ¨è§’è½</li>
                        <li>ä¿æŒä¸€è¡Œå¡«æ»¡ï¼Œä¸è¦è½»æ˜“æ‰“ä¹±</li>
                        <li>ä¼˜å…ˆæ¨ªå‘ç§»åŠ¨ï¼Œå†çºµå‘ç§»åŠ¨</li>
                        <li>åˆç†ä½¿ç”¨3æ¬¡æ’¤é”€æœºä¼š</li>
                    </ul>
                </div>
                
                <div class="keyboard-hint">
                    <h4>é”®ç›˜å¿«æ·é”®:</h4>
                    <div class="key-shortcuts">
                        <div class="key-group">
                            <kbd>â†‘</kbd><kbd>â†“</kbd><kbd>â†</kbd><kbd>â†’</kbd>
                            <span>ç§»åŠ¨æ–¹å—</span>
                        </div>
                        <div class="key-group">
                            <kbd>Ctrl</kbd> + <kbd>U</kbd>
                            <span>æ’¤é”€ç§»åŠ¨</span>
                        </div>
                        <div class="key-group">
                            <kbd>R</kbd>
                            <span>é‡æ–°å¼€å§‹</span>
                        </div>
                        <div class="key-group">
                            <kbd>ESC</kbd>
                            <span>è¿”å›èœå•</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- èƒœåˆ©/å¤±è´¥å¼¹çª— -->
        <div id="game-overlay" class="game-overlay" style="display: none;">
            <div class="overlay-content">
                <div id="game-result" class="game-result">
                    <h2 id="result-title" class="result-title"></h2>
                    <div id="result-score" class="result-score"></div>
                    <div id="result-message" class="result-message"></div>
                    
                    <div class="result-actions">
                        <button id="continue-playing" class="result-button continue-button">
                            ğŸ® ç»§ç»­æ¸¸æˆ
                        </button>
                        <button id="new-game-result" class="result-button newgame-button">
                            ğŸ”„ æ–°æ¸¸æˆ
                        </button>
                        <button id="back-to-menu-result" class="result-button menu-button">
                            ğŸ  ä¸»èœå•
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <footer class="game-footer">
            <div class="footer-info">
                <div class="game-stats">
                    <span class="stat-item">æ¸¸æˆæ¬¡æ•°: <span id="total-games-footer">0</span></span>
                    <span class="stat-item">èƒœåˆ©æ¬¡æ•°: <span id="total-wins-footer">0</span></span>
                </div>
                <div class="game-mode-info">
                    <span class="mode-indicator">ğŸ“± PWAæ¨¡å¼</span>
                    <span class="auto-save-indicator">ğŸ’¾ è‡ªåŠ¨ä¿å­˜</span>
                </div>
            </div>
            <p class="footer-note">æ”¯æŒç¦»çº¿æ¸¸ç© â€¢ è‡ªåŠ¨å­˜æ¡£ â€¢ æ”¯æŒè§¦æ‘¸æ§åˆ¶</p>
        </footer>
    </div>

    <!-- PWAå®‰è£…æç¤º -->
    <div id="pwa-install-prompt" class="pwa-prompt" style="display: none;">
        <div class="pwa-prompt-content">
            <div class="pwa-icon">ğŸ“±</div>
            <h3 class="pwa-title">æ·»åŠ åˆ°ä¸»å±å¹•</h3>
            <p class="pwa-text">å°†2048æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œè·å¾—æ›´å¥½çš„æ¸¸æˆä½“éªŒå’Œç¦»çº¿æ¸¸ç©åŠŸèƒ½</p>
            <div class="pwa-instructions">
                <p><strong>iOS:</strong> ç‚¹å‡»åˆ†äº«æŒ‰é’® â†’ "æ·»åŠ åˆ°ä¸»å±å¹•"</p>
                <p><strong>Android:</strong> ç‚¹å‡»èœå•æŒ‰é’® â†’ "æ·»åŠ åˆ°ä¸»å±å¹•"</p>
            </div>
            <div class="pwa-buttons">
                <button id="pwa-install-btn" class="pwa-button install-button">ç«‹å³æ·»åŠ </button>
                <button id="pwa-dismiss-btn" class="pwa-button dismiss-button">ç¨åå†è¯´</button>
            </div>
        </div>
    </div>

    <!-- è„šæœ¬ -->
    <script src="game.js"></script>
    
    <!-- ç½‘æ ¼ç”Ÿæˆå’Œå†…è”è„šæœ¬ -->
    <script>
        // åœ¨DOMåŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ® 2048æ¸¸æˆé¡µé¢åŠ è½½');
            
            // ç”Ÿæˆæ¸¸æˆç½‘æ ¼
            generateGameGrid();
            
            // æ£€æµ‹æ˜¯å¦ä¸ºiOSè®¾å¤‡
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            
            if (isIOS) {
                document.body.classList.add('ios-device');
            }
            
            // åˆå§‹åŒ–æŒ‰é’®äº‹ä»¶
            initGameButtons();
            
            // æ£€æŸ¥URLå‚æ•°
            checkUrlParams();
            
            // åˆå§‹åŒ–æ¸¸æˆï¼ˆè°ƒç”¨game.jsä¸­çš„initGameï¼‰
            if (typeof initGame === 'function') {
                // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
                setTimeout(initGame, 100);
            }
        });
        
        // ç”Ÿæˆæ¸¸æˆç½‘æ ¼å‡½æ•°
        function generateGameGrid() {
            const gridElement = document.getElementById('grid');
            if (!gridElement) {
                console.error('æ‰¾ä¸åˆ°ç½‘æ ¼å…ƒç´  #grid');
                return;
            }
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            gridElement.innerHTML = '';
            
            // åˆ›å»º4x4ç½‘æ ¼ï¼ˆ16å®«æ ¼ï¼‰
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.id = `cell-${row}-${col}`;
                    gridElement.appendChild(cell);
                }
            }
            
            console.log('âœ… 16å®«æ ¼åˆ›å»ºå®Œæˆï¼š4è¡ŒÃ—4åˆ—');
        }
        
        // åˆå§‹åŒ–æ¸¸æˆæŒ‰é’®äº‹ä»¶
        function initGameButtons() {
            // è¿”å›ä¸»èœå•æŒ‰é’®
            const backButton = document.getElementById('back-to-menu');
            if (backButton) {
                backButton.addEventListener('click', function() {
                    // è‡ªåŠ¨ä¿å­˜å½“å‰è¿›åº¦
                    if (typeof saveGameState === 'function') {
                        saveGameState();
                    }
                    
                    if (confirm('è¿”å›ä¸»èœå•ï¼Ÿå½“å‰æ¸¸æˆè¿›åº¦å·²è‡ªåŠ¨ä¿å­˜ã€‚')) {
                        window.location.href = 'index.html';
                    }
                });
            }
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            const restartButton = document.getElementById('restart');
            if (restartButton) {
                restartButton.addEventListener('click', function() {
                    if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) {
                        // æ¸…é™¤å­˜æ¡£
                        localStorage.removeItem('2048-current-game');
                        
                        // é‡æ–°åˆå§‹åŒ–æ¸¸æˆ
                        if (typeof initGame === 'function') {
                            initGame();
                        }
                    }
                });
            }
            
            // æ’¤é”€æŒ‰é’®
            const undoButton = document.getElementById('undo');
            if (undoButton) {
                undoButton.addEventListener('click', function() {
                    if (typeof undo === 'function') {
                        undo();
                    }
                });
            }
            
            // æç¤ºæŒ‰é’®
            const hintButton = document.getElementById('hint');
            if (hintButton) {
                hintButton.addEventListener('click', function() {
                    const hints = [
                        'ğŸ’¡ å°è¯•å°†æœ€å¤§çš„æ–¹å—å›ºå®šåœ¨è§’è½ï¼',
                        'ğŸ¯ ä¿æŒä¸€è¡Œå¡«æ»¡ï¼Œé¿å…æ‰“ä¹±å¸ƒå±€ï¼',
                        'ğŸ”„ åˆç†ä½¿ç”¨3æ¬¡æ’¤é”€æœºä¼šï¼',
                        'âš¡ ä¼˜å…ˆæ¨ªå‘ç§»åŠ¨ï¼Œå†çºµå‘ç§»åŠ¨ï¼'
                    ];
                    const randomHint = hints[Math.floor(Math.random() * hints.length)];
                    
                    const messageElement = document.getElementById('message');
                    if (messageElement) {
                        messageElement.textContent = randomHint;
                        messageElement.className = 'game-message hint';
                        
                        setTimeout(() => {
                            messageElement.textContent = '';
                            messageElement.className = 'game-message';
                        }, 3000);
                    }
                });
            }
            
            // å…¨å±æŒ‰é’®
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch(err => {
                            console.log('å…¨å±è¯·æ±‚å¤±è´¥:', err);
                        });
                    } else {
                        document.exitFullscreen();
                    }
                });
            }
            
            // æ¸¸æˆç»“æœæŒ‰é’®
            const continuePlayingBtn = document.getElementById('continue-playing');
            const newGameResultBtn = document.getElementById('new-game-result');
            const backToMenuResultBtn = document.getElementById('back-to-menu-result');
            
            if (continuePlayingBtn) {
                continuePlayingBtn.addEventListener('click', function() {
                    document.getElementById('game-overlay').style.display = 'none';
                });
            }
            
            if (newGameResultBtn) {
                newGameResultBtn.addEventListener('click', function() {
                    document.getElementById('game-overlay').style.display = 'none';
                    localStorage.removeItem('2048-current-game');
                    if (typeof initGame === 'function') {
                        initGame();
                    }
                });
            }
            
            if (backToMenuResultBtn) {
                backToMenuResultBtn.addEventListener('click', function() {
                    window.location.href = 'index.html';
                });
            }
        }
        
        // æ£€æŸ¥URLå‚æ•°
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            
            if (mode === 'continue') {
                console.log('ğŸ”„ ç»§ç»­æ¸¸æˆæ¨¡å¼');
                // è¿™é‡Œå¯ä»¥æ·»åŠ ç»§ç»­æ¸¸æˆçš„ç‰¹å®šé€»è¾‘
            }
        }
        
        // é˜²æ­¢iOSä¸‹æ‹‰åˆ·æ–°
        // ==================== ä¼˜åŒ–è§¦æ‘¸æ§åˆ¶ï¼ˆæ›¿æ¢ç¬¬327-347è¡Œï¼‰ ====================

// iOSè§¦æ‘¸ä¼˜åŒ– - æ™ºèƒ½é˜²è¯¯è§¦
let touchStartY = 0;
let isTouchInGrid = false;

// 1. è§¦æ‘¸å¼€å§‹æ£€æµ‹
document.addEventListener('touchstart', function(e) {
    const target = e.target;
    
    // æ£€æŸ¥æ˜¯å¦åœ¨æ¸¸æˆç½‘æ ¼å†…
    isTouchInGrid = !!target.closest('.game-grid');
    
    if (isTouchInGrid) {
        // è®°å½•è§¦æ‘¸èµ·å§‹ä½ç½®
        touchStartY = e.touches[0].clientY;
        
        // è½»å¾®éœ‡åŠ¨åé¦ˆï¼ˆå¯é€‰ï¼‰
        if (navigator.vibrate) {
            navigator.vibrate(5);
        }
    }
}, { passive: true });

// 2. è§¦æ‘¸ç§»åŠ¨å¤„ç† - æ™ºèƒ½é˜»æ­¢ä¸‹æ‹‰åˆ·æ–°
document.addEventListener('touchmove', function(e) {
    if (isTouchInGrid && e.cancelable) {
        // è®¡ç®—å‚ç›´ç§»åŠ¨è·ç¦»
        const currentY = e.touches[0].clientY;
        const deltaY = currentY - touchStartY;
        
        // åªåœ¨é¡µé¢é¡¶éƒ¨ä¸”å‘ä¸‹æ‹‰åŠ¨æ—¶é˜»æ­¢ï¼ˆiOSä¸‹æ‹‰åˆ·æ–°åœºæ™¯ï¼‰
        const isAtTop = window.scrollY === 0 || window.scrollY < 10;
        const isPullingDown = deltaY > 0;
        
        if (isAtTop && isPullingDown && deltaY > 20) {
            // é˜»æ­¢ä¸‹æ‹‰åˆ·æ–°ï¼Œä½†å…è®¸æ¸¸æˆå†…æ»‘åŠ¨
            e.preventDefault();
            
            // æ›´æ–°è§¦æ‘¸èµ·å§‹ä½ç½®ï¼Œé¿å…ç´¯ç§¯è·ç¦»è¿‡å¤§
            touchStartY = currentY - 10;
        }
    }
}, { passive: false });

// 3. è§¦æ‘¸ç»“æŸé‡ç½®
document.addEventListener('touchend', function() {
    isTouchInGrid = false;
}, { passive: true });

// 4. è§¦æ‘¸å–æ¶ˆå¤„ç†
document.addEventListener('touchcancel', function() {
    isTouchInGrid = false;
}, { passive: true });

// ==================== ä¿ç•™åç»­ä»£ç  ====================

// é˜²æ­¢é¡µé¢æ»šåŠ¨ï¼ˆè¿™è¡Œä¿ç•™ï¼‰
document.body.style.overflow = 'hidden';

// é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†ï¼ˆè¿™è¡Œä¿ç•™ï¼Œä½†æ³¨æ„å®ƒä»ç¬¬347è¡Œå¼€å§‹ï¼‰
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        console.log('ğŸ’¾ é¡µé¢éšè—ï¼Œè‡ªåŠ¨ä¿å­˜æ¸¸æˆ');
        if (typeof saveGameState === 'function') {
            saveGameState();
            updateFooterStats();
        }
    }
});
        
        // æ›´æ–°åº•éƒ¨ç»Ÿè®¡æ•°æ®
        function updateFooterStats() {
            try {
                const totalGames = localStorage.getItem('2048-total-games') || '0';
                const totalWins = localStorage.getItem('2048-total-wins') || '0';
                
                document.getElementById('total-games-footer').textContent = totalGames;
                document.getElementById('total-wins-footer').textContent = totalWins;
            } catch (e) {
                console.warn('æ›´æ–°ç»Ÿè®¡æ•°æ®å¤±è´¥:', e);
            }
        }
        
        // åˆå§‹åŒ–æ—¶æ›´æ–°ç»Ÿè®¡æ•°æ®
        updateFooterStats();
        
        // æš´éœ²å‡½æ•°ç»™game.jsä½¿ç”¨
        window.gamePage = {
            updateFooterStats: updateFooterStats
        };
    </script>
    
    <!-- æ ·å¼å†…è”ï¼ˆå¤‡ä»½ï¼Œé˜²æ­¢CSSåŠ è½½å¤±è´¥ï¼‰ -->
    <style>
        /* åŸºæœ¬æ¸¸æˆæ ·å¼ï¼ˆé˜²æ­¢CSSåŠ è½½å¤±è´¥ï¼‰ */
        .game-container {
            background: #faf8ef;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            background: #bbada0;
            padding: 12px;
            border-radius: 10px;
            margin: 0 auto 25px;
            width: min(90vw, 400px);
            aspect-ratio: 1/1;
        }
        
        .cell {
            background: rgba(238, 228, 218, 0.35);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: min(6vw, 32px);
            color: #776e65;
            position: relative;
            overflow: hidden;
            aspect-ratio: 1/1;
        }
        
        /* iOSå®‰å…¨åŒºåŸŸé€‚é… */
        @supports (padding-top: env(safe-area-inset-top)) {
            .game-container {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
        }
    </style>
</body>
</html>